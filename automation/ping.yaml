##################################################################
## Ping Automations
##################################################################

# WAN Down or Up Notification
- id: ping_wan_down_up_notification
  alias: WAN Down or Up Notification

  trigger:
  - platform: state
    entity_id: binary_sensor.ping_wan
    to: 'off'
    for: '00:05:00'

  condition:
  - condition: time
    after: '06:59:59'
    before: '01:00:01'

  action:
  - service: notify.notify
    data:
      message: "Internet is down for at least 5 minutes. Please check your router"
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.ping_wan
      from: 'off'
      to: 'on'
      for: '00:01:00'
  - service: notify.notify
    data:
      message: "Internet is up and running again. Thanks Goodness"
  - service: notify.mobile_app_oneplus_a6013
    data:
      message: "clear_notification"
      data:
        tag: "ping_wan_down_notification"
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "WAN is Now Up"
      message: "Internet is up and running again. Thanks Goodness"
      data:
        timeout: 600

# Kubernetes VIP Down or Up Notification
- id: ping_kube_vip_down_up_notification
  alias: Kubernetes VIP Down or Up Notification

  trigger:
  - platform: state
    entity_id: binary_sensor.ping_kube_vip
    to: 'off'
    for: '00:05:00'

  condition:
  - condition: time
    after: '06:59:59'
    before: '01:00:01'

  action:
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Kubernetes VIP is Currently Down"
      message: "Kubernetes VIP is down for at least 5 minutes. Something is broken again"
      data:
        sticky: "true"
        persistent: "true"
        tag: "ping_kube_vip_down_notification"
  - service: notify.telegram
    data:
      title: "Kubernetes VIP is Currently Down"
      message: "Kubernetes VIP is down for at least 5 minutes. Something is broken again"
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.ping_kube_vip
      from: 'off'
      to: 'on'
      for: '00:01:00'
  - service: notify.mobile_app_oneplus_a6013
    data:
      message: "clear_notification"
      data:
        tag: "ping_kube_vip_down_notification"
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Kubernetes VIP is Now Up"
      message: "Kubernetes VIP is up and running again. Thanks Goodness"
      data:
        timeout: 600
  - service: notify.telegram
    data:
      title: "Kubernetes VIP is Now Up"
      message: "Kubernetes VIP is up and running again. Thanks Goodness"

# OMV NAS Down or Up Notification
- id: ping_omv_nas_down_up_notification
  alias: OMV NAS Down or Up Notification

  trigger:
  - platform: state
    entity_id: binary_sensor.ping_omv_nas
    to: 'off'
    for: '00:05:00'

  condition:
  - condition: time
    after: '06:59:59'
    before: '01:00:01'

  action:
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "OMV NAS is Currently Down"
      message: "OMV NAS is down for at least 5 minutes. Something is broken again"
      data:
        sticky: "true"
        persistent: "true"
        tag: "ping_omv_nas_down_notification"
  - service: notify.telegram
    data:
      title: "OMV NAS is Currently Down"
      message: "OMV NAS is down for at least 5 minutes. Something is broken again"
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.ping_omv_nas
      from: 'off'
      to: 'on'
      for: '00:01:00'
  - service: notify.mobile_app_oneplus_a6013
    data:
      message: "clear_notification"
      data:
        tag: "ping_omv_nas_down_notification"
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "OMV NAS is Now Up"
      message: "OMV NAS is up and running again. Thanks Goodness"
      data:
        timeout: 600
  - service: notify.telegram
    data:
      title: "OMV NAS is Now Up"
      message: "OMV NAS is up and running again. Thanks Goodness"

# Mariadb Database Down or Up Notification
- id: ping_mariadb_database_down_up_notification
  alias: Mariadb Database Down or Up Notification

  trigger:
  - platform: state
    entity_id: binary_sensor.ping_mariadb
    to: 'off'
    for: '00:05:00'

  condition:
  - condition: time
    after: '06:59:59'
    before: '01:00:01'

  action:
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Mariadb Database is Currently Down"
      message: "Mariadb Database is down for at least 5 minutes. Something is broken again"
      data:
        sticky: "true"
        persistent: "true"
        tag: "ping_mariadb_database_down_notification"
  - service: notify.telegram
    data:
      title: "Mariadb Database is Currently Down"
      message: "Mariadb Database is down for at least 5 minutes. Something is broken again"
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.ping_mariadb
      from: 'off'
      to: 'on'
      for: '00:01:00'
  - service: notify.mobile_app_oneplus_a6013
    data:
      message: "clear_notification"
      data:
        tag: "ping_mariadb_database_down_notification"
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Mariadb Database is Now Up"
      message: "Mariadb Database is up and running again. Thanks Goodness"
      data:
        timeout: 600
  - service: notify.telegram
    data:
      title: "Mariadb Database is Now Up"
      message: "Mariadb Database is up and running again. Thanks Goodness"

# Redis Database Down or Up Notification
- id: ping_redis_database_down_up_notification
  alias: Redis Database Down or Up Notification

  trigger:
  - platform: state
    entity_id: binary_sensor.ping_redis
    to: 'off'
    for: '00:05:00'

  condition:
  - condition: time
    after: '06:59:59'
    before: '01:00:01'

  action:
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Redis Database is Currently Down"
      message: "Redis Database is down for at least 5 minutes. Something is broken again"
      data:
        sticky: "true"
        persistent: "true"
        tag: "ping_redis_database_down_notification"
  - service: notify.telegram
    data:
      title: "Redis Database is Currently Down"
      message: "Redis Database is down for at least 5 minutes. Something is broken again"
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.ping_redis
      from: 'off'
      to: 'on'
      for: '00:01:00'
  - service: notify.mobile_app_oneplus_a6013
    data:
      message: "clear_notification"
      data:
        tag: "ping_redis_database_down_notification"
  - service: notify.mobile_app_oneplus_a6013
    data:
      title: "Redis Database is Now Up"
      message: "Redis Database is up and running again. Thanks Goodness"
      data:
        timeout: 600
  - service: notify.telegram
    data:
      title: "Redis Database is Now Up"
      message: "Redis Database is up and running again. Thanks Goodness"
